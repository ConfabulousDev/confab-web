# =============================================================================
# Confab Backend — Environment Variables
# =============================================================================
# The backend binary runs in two modes:
#   ./server          — web server (HTTP API + static files)
#   ./server worker   — background analytics worker
#
# This file is organized into three sections:
#   1. Shared        — used by both web server and worker
#   2. Web Server    — only used by the web server process
#   3. Worker        — only used by the worker process
#
# Variables are uncommented with example values where a sensible local-dev
# default exists.  Commented-out variables are optional.
# =============================================================================


# ┌───────────────────────────────────────────────────────────────────────────┐
# │  1. SHARED (web server + worker)                                        │
# └───────────────────────────────────────────────────────────────────────────┘

# ── Database ─────────────────────────────────────────────────────────────────
DATABASE_URL=postgres://confab:confab@localhost:5432/confab?sslmode=disable
# Optional: separate connection string for running migrations (migrate_db.sh).
# Use this to run migrations with an elevated/admin DB user while the app
# connects with a restricted user via DATABASE_URL.  Falls back to DATABASE_URL.
# MIGRATE_DATABASE_URL=postgres://admin:pass@localhost:5432/confab?sslmode=disable

# ── S3 / MinIO Object Storage ───────────────────────────────────────────────
S3_ENDPOINT=localhost:9000
AWS_ACCESS_KEY_ID=minioadmin
AWS_SECRET_ACCESS_KEY=minioadmin
BUCKET_NAME=confab
# Use SSL for S3 connections (default: true; set to "false" for local MinIO)
S3_USE_SSL=false

# ── Smart Recap / AI ────────────────────────────────────────────────────────
# AI-powered session summaries. Requires all four vars to be set.
# Used by the web server for on-demand generation and by the worker for
# background precomputation.
# SMART_RECAP_ENABLED=false
# ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxx
# SMART_RECAP_MODEL=claude-haiku-4-5-20251001
# SMART_RECAP_QUOTA_LIMIT=500        # monthly generation limit (required if enabled)
# SMART_RECAP_MAX_OUTPUT_TOKENS=1000      # max LLM output tokens (default: 1000)
# SMART_RECAP_MAX_TRANSCRIPT_TOKENS=50000 # max input tokens (~chars/4, default: 50000)

# ── Logging ──────────────────────────────────────────────────────────────────
# Levels: debug, info, warn, error (default: info)
# LOG_LEVEL=info

# ── OpenTelemetry / Tracing ─────────────────────────────────────────────────
# OTEL_SERVICE_NAME=confabulous-backend
# OTEL_EXPORTER_OTLP_ENDPOINT=https://api.honeycomb.io
# OTEL_EXPORTER_OTLP_HEADERS=x-honeycomb-team=your-api-key


# ┌───────────────────────────────────────────────────────────────────────────┐
# │  2. WEB SERVER                                                          │
# └───────────────────────────────────────────────────────────────────────────┘

# ── Server ───────────────────────────────────────────────────────────────────
PORT=8080
# Backend URL — used for device-code / CLI authorization flow
# (default: http://localhost:8080)
# BACKEND_URL=http://localhost:8080
# Directory for serving the built frontend (default: /app/static in Docker)
# STATIC_FILES_DIR=/app/static

# ── Security ─────────────────────────────────────────────────────────────────
# CSRF secret key — must be at least 32 characters
CSRF_SECRET_KEY=your-csrf-secret-key-at-least-32-chars
# Disable secure-cookie requirements for local development (default: false)
# Set to "true" when developing without HTTPS
# INSECURE_DEV_MODE=false

# ── CORS & URLs ──────────────────────────────────────────────────────────────
# Comma-separated list of allowed origins
ALLOWED_ORIGINS=http://localhost:5173
# Frontend URL — used for OAuth redirects, email links, and CORS
FRONTEND_URL=http://localhost:5173

# ── Authentication ───────────────────────────────────────────────────────────
# At least one auth method must be enabled.

# Restrict login to specific email domains (optional, comma-separated)
# Applies to all auth methods.  Empty/unset = all domains allowed.
# ALLOWED_EMAIL_DOMAINS=company.com,partner.com

# -- Password auth (recommended for self-hosted) --
# Set to "true" to enable username/password login
AUTH_PASSWORD_ENABLED=true

# Admin bootstrap — creates an admin user on first startup if no users exist.
# Remove these after initial setup for security.
ADMIN_BOOTSTRAP_EMAIL=admin@example.com
ADMIN_BOOTSTRAP_PASSWORD=change-me-immediately

# -- GitHub OAuth (optional) --
# Create an OAuth app at: https://github.com/settings/developers
# GITHUB_CLIENT_ID=your_github_client_id_here
# GITHUB_CLIENT_SECRET=your_github_client_secret_here
# GITHUB_REDIRECT_URL=http://localhost:8080/auth/github/callback

# -- Google OAuth (optional) --
# Create OAuth credentials at: https://console.cloud.google.com/apis/credentials
# GOOGLE_CLIENT_ID=your_google_client_id_here
# GOOGLE_CLIENT_SECRET=your_google_client_secret_here
# GOOGLE_REDIRECT_URL=http://localhost:8080/auth/google/callback

# -- Generic OIDC (optional) --
# Works with Okta, Auth0, Azure AD, Keycloak, etc.
# Uses OIDC Discovery (/.well-known/openid-configuration).
# All four vars must be set to enable OIDC.
# OIDC_ISSUER_URL=https://dev-12345.okta.com
# OIDC_CLIENT_ID=your_oidc_client_id_here
# OIDC_CLIENT_SECRET=your_oidc_client_secret_here
# OIDC_REDIRECT_URL=http://localhost:8080/auth/oidc/callback
# OIDC_DISPLAY_NAME=Okta   # default "SSO" — controls button text ("Continue with …")

# ── Email ────────────────────────────────────────────────────────────────────
# Email is enabled when both RESEND_API_KEY and EMAIL_FROM_ADDRESS are set.
# Get an API key at https://resend.com
RESEND_API_KEY=re_xxxxxxxxxxxx
EMAIL_FROM_ADDRESS=noreply@example.com
EMAIL_FROM_NAME=Confab
# EMAIL_RATE_LIMIT_PER_HOUR=100      # per-user rate limit (default: 100)
# SUPPORT_EMAIL=support@example.com  # support email shown in UI and exposed via /api/v1/auth/config

# ── Admin & User Management ─────────────────────────────────────────────────
# Comma-separated super-admin email addresses (grants admin API access)
# SUPER_ADMIN_EMAILS=admin@example.com
# Maximum number of users (default: 50, set to 0 to block new registrations)
# MAX_USERS=50

# ── Deployment Features ─────────────────────────────────────────────────────
# Share-all-sessions mode — every session visible to every authenticated user
# Intended for on-prem / team deployments (default: false)
# SHARE_ALL_SESSIONS_TO_AUTHENTICATED=false
# Disable share link creation (default: false)
# DISABLE_SHARE_CREATION=false
# Hide the frontend footer (GitHub, Discord, Help links, copyright)
# DISABLE_FOOTER=false

# ── HTTP Tuning ──────────────────────────────────────────────────────────────
# HTTP_READ_TIMEOUT=30s
# HTTP_WRITE_TIMEOUT=30s

# ── Debug / Profiling ───────────────────────────────────────────────────────
# Set to "true" to enable pprof server on localhost:6060
# ENABLE_PPROF=false


# ┌───────────────────────────────────────────────────────────────────────────┐
# │  3. WORKER (background analytics)                                       │
# └───────────────────────────────────────────────────────────────────────────┘

# ── Worker Settings ──────────────────────────────────────────────────────────
# WORKER_POLL_INTERVAL=30m           # how often to check for stale sessions
# WORKER_MAX_SESSIONS=20             # max sessions per cycle (required in worker mode)
# WORKER_DRY_RUN=false               # log what would be done without processing

# ── Staleness Thresholds (advanced) ─────────────────────────────────────────
# Override when a session is considered "stale" and needs recomputation.
# Two prefixes: WORKER_REGULAR_ (analytics cards) and WORKER_RECAP_ (smart recap).
#
# WORKER_REGULAR_THRESHOLD_PCT=0.20        # % change to trigger recompute (0–1)
# WORKER_REGULAR_BASE_MIN_LINES=5          # minimum new lines before recompute
# WORKER_REGULAR_BASE_MIN_TIME=3m          # minimum age of new data
# WORKER_REGULAR_MIN_INITIAL_LINES=10      # minimum lines for first computation
# WORKER_REGULAR_MIN_SESSION_AGE=10m       # minimum session age
#
# WORKER_RECAP_THRESHOLD_PCT=0.20
# WORKER_RECAP_BASE_MIN_LINES=150
# WORKER_RECAP_BASE_MIN_TIME=30m
# WORKER_RECAP_MIN_INITIAL_LINES=25
# WORKER_RECAP_MIN_SESSION_AGE=10m


# ┌───────────────────────────────────────────────────────────────────────────┐
# │  4. FRONTEND (build-time, set when building the Vite app)               │
# └───────────────────────────────────────────────────────────────────────────┘
# These use the VITE_ prefix and are embedded at build time via import.meta.env.
# Currently no build-time frontend variables are required. SUPPORT_EMAIL is
# now served at runtime via the backend's /api/v1/auth/config endpoint.
